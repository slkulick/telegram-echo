<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Telegram Echo</title>
    <base target="_top">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  </head>
  <body>
    <h1>Telegram Echo</h1>
    <form id="telegram_form">
      <p>
        <label for="url">This URL:</label>
        <input type="text" id="url" name="url" value="{{ url }}">
      </p>
      <p>
        <label for="token">Telegram Bot Token:</label>
        <input type="text" id="token" name="token">
      </p>
      <input type="submit" value="Submit">
    </form>
    <script>
      $("#telegram_form").on("submit", function(event) {
        event.preventDefault(); //prevent form from submitting

        let data = {};
        $(this).serializeArray().map((x) => {
          data[x.name] = x.value;
        });
       
        const telegram_url = "https://api.telegram.org/bot" + data.token;
        const url = window.location.href;
        $.get(telegram_url + "/setWebhook", {url: data.url}, (response) => {
          console.log(response);
        });
      });
    </script>
  </body>
</html>